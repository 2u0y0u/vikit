<!DOCTYPE html>
<html class=" ">
{% include 'header.html' %}
<head> </head>
<body class="">
  {% include 'left.html' %}
<main>
    {% include 'banner.html' %}
    <div class="container-fluid">
        <h1 class="bread-crumb"> <strong>扫描结果</strong>
            <div class="absolute-right">
                <form action="" method="post" class="input-group search-group" data-format="HTML" data-action="notpjax">
                    
                </form>
            </div> </h1>
        <table class="table table-hover">
            <thead>
            <tr>
                <th>task_id</th>
                <th>state</th>
                <th>action</th>
                
            </tr>
            
            </thead>
            <tbody id="resulist">

            </tbody>
        </table>
    </div>
</main>

<script>
var task_id=new Array();
var interval1;
   function show_result(){
    var str='{{result|safe}}';
    var result_dic=jQuery.parseJSON(str);
    var i=0;
    for (var key in result_dic){
        task_id[i]=key;
        i++;
    }
    var num=task_id.length;
    $("#resulist").empty();
    for(var j=0;j<num;j++){
        $.ajax(
            {
                url: "/task_status/"+task_id[j],
                async:false,
                success: function (result) {
                    //add li to ul
                    if(result=="finished"){
                    var tr='<tr><th>'+task_id[j]+'</th><th>'+result+'</th><th><a data="'+task_id[j]+'" href="result/'+task_id[j]+'" style="color:green">查看</a></th></tr>';
                    $("#resulist").append(tr);
                    }
                    else{
                        var tr='<tr><th>'+task_id[j]+'</th><th>'+result+'</th><th><a data="'+task_id[j]+'" style="color:red">未完成</a></th></tr>';
                        $("#resulist").prepend(tr);
                    }
                    
                },
                error:function () {
                    alert('ajax get_mods request error');
                }

            }
        )
    }
   }
   $(document).ready(function(){
    show_result();
    interval1=setInterval("show_result()",3000);
   });
</script>
<script>
    

</script>
</body>
</html>